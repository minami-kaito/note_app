import{r as c,m as J,j as H,a as f,C as oe,o as ie,c as F,p as ae,q as Q,D as le,s as X,t as ce,v as Z,w as ue,u as ee,g as fe,x as de,d as j,$ as K,y as z,z as W,K as me,k as M,A as ge,i as pe,l as he,G as Se,n as Ee,S as Ce,H as xe,I as Ne,F as ye,J as Te,N as be,L as Le,O as Re,P as $e,Q as _e,R as Ie,T as De,U as Pe,V as Ae,W as Me}from"./main.ef29de94.js";import{L as ve}from"./LexicalNestedComposer.b813f49c.js";import{I as we}from"./ImageResizer.653e3213.js";const te=Object.freeze({"	":"\\t","\n":"\\n"}),Y=new RegExp(Object.keys(te).join("|"),"g"),L=Object.freeze({ancestorHasNextSibling:"|",ancestorIsLastChild:" ",hasNextSibling:"\u251C",isLastChild:"\u2514",selectedChar:"^",selectedLine:">"});function Oe({treeTypeButtonClassName:e,timeTravelButtonClassName:t,timeTravelPanelSliderClassName:n,timeTravelPanelButtonClassName:r,viewClassName:i,timeTravelPanelClassName:a,editor:s}){const[o,C]=c.exports.useState([]),[d,u]=c.exports.useState(""),[S,x]=c.exports.useState(!1),[m,R]=c.exports.useState(!1),E=c.exports.useRef(0),P=c.exports.useRef(null),g=c.exports.useRef(null),[$,v]=c.exports.useState(!1),[_,w]=c.exports.useState(!1),[N,B]=c.exports.useState(!1),O=c.exports.useRef(null),I=ke(s),k=c.exports.useCallback(l=>{const T=G(s,I,m);u(T),S||C(y=>[...y,[Date.now(),l]])},[I,s,S,m]);c.exports.useEffect(()=>{const l=s.getEditorState();!N&&l._nodeMap.size<1e3&&u(G(s,I,m))},[I,s,N,m]),c.exports.useEffect(()=>J(s.registerUpdateListener(({editorState:l})=>{!N&&l._nodeMap.size>1e3&&(O.current=l,w(!0),!N)||k(l)}),s.registerEditableListener(()=>{const l=G(s,I,m);u(l)})),[I,s,m,_,k,N]);const D=o.length;return c.exports.useEffect(()=>{if($){let l;const T=()=>{const y=E.current;if(y===D-1){v(!1);return}const p=o[y][0],h=o[y+1][0]-p;l=setTimeout(()=>{E.current++;const A=E.current,U=g.current;U!==null&&(U.value=String(A)),s.setEditorState(o[A][1]),T()},h)};return T(),()=>{clearTimeout(l)}}},[o,$,s,D]),c.exports.useEffect(()=>{const l=P.current;if(l!==null)return l.__lexicalEditor=s,()=>{l.__lexicalEditor=null}},[s]),H("div",{className:i,children:[!N&&_?H("div",{style:{padding:20},children:[f("span",{style:{marginRight:20},children:"Detected large EditorState, this can impact debugging performance."}),f("button",{onClick:()=>{B(!0);const l=O.current;l!==null&&(O.current=null,k(l))},style:{background:"transparent",border:"1px solid white",color:"white",cursor:"pointer",padding:5},children:"Show full tree"})]}):null,N?null:f("button",{onClick:()=>R(!m),className:e,type:"button",children:m?"Tree":"Export DOM"}),!S&&(N||!_)&&D>2&&f("button",{onClick:()=>{const l=s.getRootElement();l!==null&&(l.contentEditable="false",E.current=D-1,x(!0))},className:t,type:"button",children:"Time Travel"}),(N||!_)&&f("pre",{ref:P,children:d}),S&&(N||!_)&&H("div",{className:a,children:[f("button",{className:r,onClick:()=>{E.current===D-1&&(E.current=1),v(!$)},type:"button",children:$?"Pause":"Play"}),f("input",{className:n,ref:g,onChange:l=>{const T=Number(l.target.value),y=o[T];y&&(E.current=T,s.setEditorState(y[1]))},type:"range",min:"1",max:D-1}),f("button",{className:r,onClick:()=>{const l=s.getRootElement();if(l!==null){l.contentEditable="true";const T=o.length-1,y=o[T];s.setEditorState(y[1]);const p=g.current;p!==null&&(p.value=String(T)),x(!1),v(!1)}},type:"button",children:"Exit"})]})]})}function ke(e){const[t,n]=c.exports.useState([]);return c.exports.useEffect(()=>{const r=new Set;for(const[i]of e._commands)r.add(e.registerCommand(i,a=>(n(s=>{const o=[...s];return o.push({payload:a,type:i.type?i.type:"UNKNOWN"}),o.length>10&&o.shift(),o}),!1),oe));return()=>r.forEach(i=>i())},[e]),c.exports.useMemo(()=>t,[t])}function je(e){let t="";const n=se(e);t+=`: range ${n!==""?`{ ${n} }`:""} ${e.style!==""?`{ style: ${e.style} } `:""}`;const r=e.anchor,i=e.focus,a=r.offset,s=i.offset;return t+=`
  \u251C anchor { key: ${r.key}, offset: ${a===null?"null":a}, type: ${r.type} }`,t+=`
  \u2514 focus { key: ${i.key}, offset: ${s===null?"null":s}, type: ${i.type} }`,t}function He(e){return`: node
  \u2514 [${Array.from(e._nodes).join(", ")}]`}function Be(e){return`: grid
  \u2514 { grid: ${e.gridKey}, anchorCell: ${e.anchor.key}, focusCell: ${e.focus.key} }`}function G(e,t,n){const r=e.getEditorState(),i=e._config,a=e._compositionKey,s=e._editable;if(n){let d="";return r.read(()=>{d=Ze(ie(e))}),d}let o=` root
`;const C=r.read(()=>{const d=F();return ne(ae(),(u,S)=>{const m=`(${u.getKey()})`,R=u.getType()||"",E=u.isSelected(),P=ce(u)?` id: [ ${u.getIDs().join(", ")} ] `:"";o+=`${E?L.selectedLine:" "} ${S.join(" ")} ${m} ${R} ${P} ${Fe(u)}
`,o+=Xe({indent:S,isSelected:E,node:u,nodeKeyDisplay:m,selection:d,typeDisplay:R})}),d===null?": null":Q(d)?je(d):le(d)?Be(d):He(d)});if(o+=`
 selection`+C,o+=`

 commands:`,t.length)for(const{type:d,payload:u}of t)o+=`
  \u2514 { type: ${d}, payload: ${u instanceof Event?u.constructor.name:u} }`;else o+=`
  \u2514 None dispatched.`;return o+=`

 editor:`,o+=`
  \u2514 namespace ${i.namespace}`,a!==null&&(o+=`
  \u2514 compositionKey ${a}`),o+=`
  \u2514 editable ${String(s)}`,o}function ne(e,t,n=[]){const r=e.getChildren(),i=r.length;r.forEach((a,s)=>{t(a,n.concat(s===i-1?L.isLastChild:L.hasNextSibling)),X(a)&&ne(a,t,n.concat(s===i-1?L.ancestorIsLastChild:L.ancestorHasNextSibling))})}function V(e){return Object.entries(te).reduce((t,[n,r])=>t.replace(new RegExp(n,"g"),String(r)),e)}function Fe(e){if(Z(e)){const t=e.getTextContent(),n=t.length===0?"(empty)":`"${V(t)}"`,r=Ue(e);return[n,r.length!==0?`{ ${r} }`:null].filter(Boolean).join(" ").trim()}else if(ue(e)){const t=e.getURL(),n=t.length===0?"(empty)":`"${V(t)}"`,r=We(e);return[n,r.length!==0?`{ ${r} }`:null].filter(Boolean).join(" ").trim()}else return""}const Ke=[e=>e.hasFormat("bold")&&"Bold",e=>e.hasFormat("code")&&"Code",e=>e.hasFormat("italic")&&"Italic",e=>e.hasFormat("strikethrough")&&"Strikethrough",e=>e.hasFormat("subscript")&&"Subscript",e=>e.hasFormat("superscript")&&"Superscript",e=>e.hasFormat("underline")&&"Underline"],ze=[e=>e.isDirectionless()&&"Directionless",e=>e.isUnmergeable()&&"Unmergeable"],Ge=[e=>e.isToken()&&"Token",e=>e.isSegmented()&&"Segmented"];function Ue(e){return[se(e),Ye(e),Ve(e)].filter(Boolean).join(", ")}function We(e){return[qe(e),Je(e),Qe(e)].filter(Boolean).join(", ")}function Ye(e){let t=ze.map(n=>n(e)).filter(Boolean).join(", ").toLocaleLowerCase();return t!==""&&(t="detail: "+t),t}function Ve(e){let t=Ge.map(n=>n(e)).filter(Boolean).join(", ").toLocaleLowerCase();return t!==""&&(t="mode: "+t),t}function se(e){let t=Ke.map(n=>n(e)).filter(Boolean).join(", ").toLocaleLowerCase();return t!==""&&(t="format: "+t),t}function qe(e){let t=e.getTarget();return t!=null&&(t="target: "+t),t}function Je(e){let t=e.getRel();return t!=null&&(t="rel: "+t),t}function Qe(e){let t=e.getTitle();return t!=null&&(t="title: "+t),t}function Xe({indent:e,isSelected:t,node:n,nodeKeyDisplay:r,selection:i,typeDisplay:a}){if(!Z(n)||!Q(i)||!t||X(n))return"";const s=i.anchor,o=i.focus;if(n.getTextContent()===""||s.getNode()===i.focus.getNode()&&s.offset===o.offset)return"";const[C,d]=et(n,i);if(C===d)return"";const u=e[e.length-1]===L.hasNextSibling?L.ancestorHasNextSibling:L.ancestorIsLastChild,S=[...e.slice(0,e.length-1),u],x=Array(C+1).fill(" "),m=Array(d-C).fill(L.selectedChar),R=a.length+3,E=Array(r.length+R).fill(" ");return[L.selectedLine,S.join(" "),[...E,...x,...m].join("")].join(" ")+`
`}function Ze(e){const t=document.createElement("div");return t.innerHTML=e.trim(),re(t,0).innerHTML}function re(e,t){const n=new Array(t+++1).join("  "),r=new Array(t-1).join("  ");let i;for(let a=0;a<e.children.length;a++)i=document.createTextNode(`
`+n),e.insertBefore(i,e.children[a]),re(e.children[a],t),e.lastElementChild===e.children[a]&&(i=document.createTextNode(`
`+r),e.appendChild(i));return e}function et(e,t){const n=t.anchor,r=t.focus,i=e.getTextContent(),a=i.length;let s=-1,o=-1;if(n.type==="text"&&r.type==="text"){const u=n.getNode(),S=r.getNode();u===S&&e===u&&n.offset!==r.offset?[s,o]=n.offset<r.offset?[n.offset,r.offset]:[r.offset,n.offset]:e===u?[s,o]=u.isBefore(S)?[n.offset,a]:[0,n.offset]:e===S?[s,o]=S.isBefore(u)?[r.offset,a]:[0,r.offset]:[s,o]=[0,a]}const C=(i.slice(0,s).match(Y)||[]).length,d=(i.slice(s,o).match(Y)||[]).length;return[s+C,o+C+d]}function tt(){const[e]=ee();return f(Oe,{viewClassName:"tree-view-output",treeTypeButtonClassName:"debug-treetype-button",timeTravelPanelClassName:"debug-timetravel-panel",timeTravelButtonClassName:"debug-timetravel-button",timeTravelPanelSliderClassName:"debug-timetravel-panel-slider",timeTravelPanelButtonClassName:"debug-timetravel-panel-button",editor:e})}const q=new Set;function nt(e){if(!q.has(e))throw new Promise(t=>{const n=new Image;n.src=e,n.onload=()=>{q.add(e),t(null)}})}function st({altText:e,className:t,imageRef:n,src:r,width:i,height:a,maxWidth:s}){return nt(r),f("img",{className:t||void 0,src:r,alt:e,ref:n,style:{height:a,maxWidth:s,width:i},draggable:"false"})}function at({src:e,altText:t,nodeKey:n,width:r,height:i,maxWidth:a,resizable:s,showCaption:o,caption:C,captionsEnabled:d}){const u=c.exports.useRef(null),S=c.exports.useRef(null),[x,m,R]=fe(n),[E,P]=c.exports.useState(!1);de();const[g]=ee(),[$,v]=c.exports.useState(null),_=c.exports.useRef(null),w=c.exports.useCallback(p=>{if(x&&j(F())){p.preventDefault();const h=K(n);z(h)&&h.remove(),m(!1)}return!1},[x,n,m]),N=c.exports.useCallback(p=>{const b=F(),h=S.current;if(x&&j(b)&&b.getNodes().length===1){if(o)return W(null),p.preventDefault(),C.focus(),!0;if(h!==null&&h!==document.activeElement)return p.preventDefault(),h.focus(),!0}return!1},[C,x,o]),B=c.exports.useCallback(p=>_.current===C||S.current===p.target?(W(null),g.update(()=>{m(!0);const b=g.getRootElement();b!==null&&b.focus()}),!0):!1,[C,g,m]);c.exports.useEffect(()=>{let p=!0;const b=J(g.registerUpdateListener(({editorState:h})=>{p&&v(h.read(()=>F()))}),g.registerCommand(Ce,(h,A)=>(_.current=A,!1),M),g.registerCommand(Ee,h=>{const A=h;return E?!0:A.target===u.current?(A.shiftKey?m(!x):(R(),m(!0)),!0):!1},M),g.registerCommand(Se,h=>h.target===u.current?(h.preventDefault(),!0):!1,M),g.registerCommand(he,w,M),g.registerCommand(pe,w,M),g.registerCommand(ge,N,M),g.registerCommand(me,B,M));return()=>{p=!1,b()}},[R,g,E,x,n,w,N,B,m]);const O=()=>{g.update(()=>{const p=K(n);z(p)&&p.setShowCaption(!0)})},I=(p,b)=>{setTimeout(()=>{P(!1)},200),g.update(()=>{const h=K(n);z(h)&&h.setWidthAndHeight(p,b)})},k=()=>{P(!0)},{historyState:D}=xe(),{settings:{showNestedEditorTreeView:l}}=Ne(),T=x&&j($)&&!E,y=x||E;return f(c.exports.Suspense,{fallback:null,children:H(ye,{children:[f("div",{draggable:T,children:f(st,{className:y?`focused ${j($)?"draggable":""}`:null,src:e,altText:t,imageRef:u,width:r,height:i,maxWidth:a})}),o&&f("div",{className:"image-caption-container",children:H(ve,{initialEditor:C,children:[f(Te,{}),f(be,{}),f(Le,{}),f(Re,{}),f($e,{}),f(_e,{}),f(Ie,{externalHistoryState:D}),f(De,{contentEditable:f(Pe,{className:"ImageNode__contentEditable"}),placeholder:f(Ae,{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:Me}),l===!0?f(tt,{}):null]})}),s&&j($)&&y&&f(we,{showCaption:o,setShowCaption:O,editor:g,buttonRef:S,imageRef:u,maxWidth:a,onResizeStart:k,onResizeEnd:I,captionsEnabled:d})]})})}export{at as default};
