import{u as D,r as _,g as E,d as P,c as O,$ as k,Z as S,m as I,i as M,k as f,l as $,n as A,a as t,j as v,B as R,x as L,_ as b,a0 as V}from"./main.ef29de94.js";function j(s){return s.reduce((c,o)=>c+o.votes.length,0)}function y({option:s,index:c,options:o,totalVotes:r,withPollNode:N}){const{clientID:i}=L(),p=_.exports.useRef(null),m=s.votes,h=m.indexOf(i)!==-1,d=m.length,C=s.text;return v("div",{className:"PollNode__optionContainer",children:[t("div",{className:b("PollNode__optionCheckboxWrapper",h&&"PollNode__optionCheckboxChecked"),children:t("input",{ref:p,className:"PollNode__optionCheckbox",type:"checkbox",onChange:u=>{N(n=>{n.toggleVote(s,i)})},checked:h})}),v("div",{className:"PollNode__optionInputWrapper",children:[t("div",{className:"PollNode__optionInputVotes",style:{width:`${d===0?0:d/r*100}%`}}),t("span",{className:"PollNode__optionInputVotesCount",children:d>0&&(d===1?"1 vote":`${d} votes`)}),t("input",{className:"PollNode__optionInput",type:"text",value:C,onChange:u=>{const n=u.target,x=n.value,e=n.selectionStart,l=n.selectionEnd;N(a=>{a.setOptionText(s,x)},()=>{n.selectionStart=e,n.selectionEnd=l})},placeholder:`Option ${c+1}`})]}),t("button",{disabled:o.length<3,className:b("PollNode__optionDelete",o.length<3&&"PollNode__optionDeleteDisabled"),"aria-label":"Remove",onClick:()=>{N(u=>{u.deleteOption(s)})}})]})}function T({question:s,options:c,nodeKey:o}){const[r]=D(),N=_.exports.useMemo(()=>j(c),[c]),[i,p,m]=E(o),[g,h]=_.exports.useState(null),d=_.exports.useRef(null),C=_.exports.useCallback(e=>{if(i&&P(O())){e.preventDefault();const a=k(o);S(a)&&a.remove(),p(!1)}return!1},[i,o,p]);_.exports.useEffect(()=>I(r.registerUpdateListener(({editorState:e})=>{h(e.read(()=>O()))}),r.registerCommand(A,e=>{const l=e;return l.target===d.current?(l.shiftKey||m(),p(!i),!0):!1},f),r.registerCommand($,C,f),r.registerCommand(M,C,f)),[m,r,i,o,C,p]);const u=(e,l)=>{r.update(()=>{const a=k(o);S(a)&&e(a)},{onUpdate:l})},n=()=>{u(e=>{e.addOption(V())})},x=P(g)&&i;return t("div",{className:`PollNode__container ${x?"focused":""}`,ref:d,children:v("div",{className:"PollNode__inner",children:[t("h2",{className:"PollNode__heading",children:s}),c.map((e,l)=>{const a=e.uid;return t(y,{withPollNode:u,option:e,index:l,options:c,totalVotes:N},a)}),t("div",{className:"PollNode__footer",children:t(R,{onClick:n,small:!0,children:"Add Option"})})]})})}export{T as default};
