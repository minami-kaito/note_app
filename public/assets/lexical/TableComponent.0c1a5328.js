import{g as Le,r as x,au as Te,u as Pe,av as ge,aw as $e,$ as be,ax as ve,ay as $,p as j,az as ue,m as Ke,K as Ye,c as Y,q,k as z,ac as ze,af as Xe,aA as Be,aB as Fe,aC as Je,A as He,d as Ne,aD as je,l as We,i as Ue,a4 as Se,a5 as Ee,a3 as we,n as qe,j as ne,a as f,F as Ae,f as Ge,aE as Qe,aF as Ce,o as Ve,aG as xe,aH as Ze,aI as De,aJ as et,aK as tt,aL as nt,aM as lt,aN as st,aO as rt}from"./main.97ee7197.js";import{L as ot}from"./LexicalNestedComposer.3c887533.js";const G=[];function at(){const n=Qe();return n.focus.set("root",j().getChildrenSize(),"element"),n}function ct(n){return`<p class="${n.paragraph}"><br></p>`}function me(n,l){const c=n.querySelector(`[data-id=${l}]`);c!=null&&c.focus()}function it(n){return n.nodeType===1&&n.hasAttribute("data-table-resize")}function ut(n,l){const c=l.parseEditorState(n);let i=Ce.get(n);if(i===void 0){i=c.read(()=>Ve(l,null));const E=c.read(()=>j().getTextContent());Ce.set(n,i),ge.set(n,E)}return i}function Re(n){const l=n.getRootElement();return l!==null?l.ownerDocument:document}function dt(n,l,c,i){return l?!1:n===67?xe?c:i:!1}function ft(n,l,c,i){return l?!1:n===88?xe?c:i:!1}function pt(n,l,c,i){return l?!1:n===86?xe?c:i:!1}function he(n){let l=n;for(;l!==null;){const c=l.getAttribute("data-id");if(c!=null)return c;l=l.parentElement}return null}function mt(n){let l=n;for(;l!==null;){if(l.nodeName==="TH"||l.nodeName==="TD")return l.getBoundingClientRect().width;l=l.parentElement}return 0}function te(n,l,c,i,E,b){for(const y of l){const A=de(n,y,c);if(A!==null&&i!==null){const I=i.parseEditorState(A.json);i._headless=!0,i.setEditorState(I),i.update(b,{discrete:!0}),i._headless=!1;const P=JSON.stringify(i.getEditorState());E(w=>{const[M,k]=c.get(y);$("history-push"),w.updateCellJSON(M,k,P)})}}}function ht(n){let l=n;for(;l!==null;){const c=l.nodeName;if(c==="BUTTON"||c==="INPUT"||c==="TEXTAREA")return!0;l=l.parentElement}return!1}function Ie(n,l,c){const i=c.get(n),E=c.get(l);if(i===void 0||E===void 0)return null;const b=Math.min(i[0],E[0]),y=Math.max(i[0],E[0]),A=Math.min(i[1],E[1]),I=Math.max(i[1],E[1]);return{endX:y,endY:I,startX:b,startY:A}}function Me(n,l,c,i){const E=Ie(l,c,i);if(E===null)return[];const{startX:b,endY:y,endX:A,startY:I}=E,P=[];for(let w=b;w<=A;w++)for(let M=I;M<=y;M++)P.push(n[M].cells[w].id);return P}function gt(n,l){const{startX:c,endY:i,endX:E,startY:b}=l,y=[];for(let A=b;A<=i;A++){const I=n[A],P=st();for(let w=c;w<=E;w++){const M={...I.cells[w]};M.id=rt(),P.cells.push(M)}y.push(P)}return y}function Ct({cellEditor:n}){const{cellEditorConfig:l,cellEditorPlugins:c}=x.exports.useContext(Te);return c===null||l===null?null:f(ot,{initialEditor:n,initialTheme:l.theme,initialNodes:l.nodes,skipCollabChecks:!0,children:c})}function de(n,l,c){const i=c.get(l);if(i===void 0)return null;const[E,b]=i;return n[b].cells[E]}function xt({cell:n,rows:l,cellCoordMap:c,menuElem:i,updateCellsByID:E,onClose:b,updateTableNode:y,setSortingOptions:A,sortingOptions:I}){const P=x.exports.useRef(null);x.exports.useEffect(()=>{const e=P.current;if(e!==null){const v=i.getBoundingClientRect();e.style.top=`${v.y}px`,e.style.left=`${v.x}px`}},[i]),x.exports.useEffect(()=>{const e=v=>{const W=P.current;W!==null&&!W.contains(v.target)&&v.stopPropagation()};return window.addEventListener("click",e),()=>window.removeEventListener("click",e)},[b]);const w=c.get(n.id);if(w===void 0)return null;const[M,k]=w;return ne("div",{className:"dropdown",ref:P,onPointerMove:e=>{e.stopPropagation()},onPointerDown:e=>{e.stopPropagation()},onPointerUp:e=>{e.stopPropagation()},onClick:e=>{e.stopPropagation()},children:[f("button",{className:"item",onClick:()=>{y(e=>{$("history-push"),e.updateCellType(M,k,n.type==="normal"?"header":"normal")}),b()},children:f("span",{className:"text",children:n.type==="normal"?"Make header":"Remove header"})}),f("button",{className:"item",onClick:()=>{E([n.id],()=>{const e=j();e.clear(),e.append(ue())}),b()},children:f("span",{className:"text",children:"Clear cell"})}),f("hr",{}),n.type==="header"&&k===0&&ne(Ae,{children:[I!==null&&I.x===M&&f("button",{className:"item",onClick:()=>{A(null),b()},children:f("span",{className:"text",children:"Remove sorting"})}),(I===null||I.x!==M||I.type==="descending")&&f("button",{className:"item",onClick:()=>{A({type:"ascending",x:M}),b()},children:f("span",{className:"text",children:"Sort ascending"})}),(I===null||I.x!==M||I.type==="ascending")&&f("button",{className:"item",onClick:()=>{A({type:"descending",x:M}),b()},children:f("span",{className:"text",children:"Sort descending"})}),f("hr",{})]}),f("button",{className:"item",onClick:()=>{y(e=>{$("history-push"),e.insertRowAt(k)}),b()},children:f("span",{className:"text",children:"Insert row above"})}),f("button",{className:"item",onClick:()=>{y(e=>{$("history-push"),e.insertRowAt(k+1)}),b()},children:f("span",{className:"text",children:"Insert row below"})}),f("hr",{}),f("button",{className:"item",onClick:()=>{y(e=>{$("history-push"),e.insertColumnAt(M)}),b()},children:f("span",{className:"text",children:"Insert column left"})}),f("button",{className:"item",onClick:()=>{y(e=>{$("history-push"),e.insertColumnAt(M+1)}),b()},children:f("span",{className:"text",children:"Insert column right"})}),f("hr",{}),l[0].cells.length!==1&&f("button",{className:"item",onClick:()=>{y(e=>{$("history-push"),e.deleteColumnAt(M)}),b()},children:f("span",{className:"text",children:"Delete column"})}),l.length!==1&&f("button",{className:"item",onClick:()=>{y(e=>{$("history-push"),e.deleteRowAt(k)}),b()},children:f("span",{className:"text",children:"Delete row"})}),f("button",{className:"item",onClick:()=>{y(e=>{$("history-push"),e.selectNext(),e.remove()}),b()},children:f("span",{className:"text",children:"Delete table"})})]})}function yt({cell:n,cellCoordMap:l,cellEditor:c,isEditing:i,isSelected:E,isPrimarySelected:b,theme:y,updateCellsByID:A,updateTableNode:I,rows:P,setSortingOptions:w,sortingOptions:M}){const[k,e]=x.exports.useState(!1),v=x.exports.useRef(null),W=n.type!=="normal",le=n.json,fe=W?"th":"td",se=n.width,h=v.current,X=l.get(n.id),U=M!==null&&X!==void 0&&X[0]===M.x&&X[1]===0;return x.exports.useEffect(()=>{(i||!b)&&e(!1)},[i,b]),ne(fe,{className:`${y.tableCell} ${W?y.tableCellHeader:""} ${E?y.tableCellSelected:""}`,"data-id":n.id,tabIndex:-1,style:{width:se!==null?se:void 0},children:[b&&f("div",{className:`${y.tableCellPrimarySelected} ${i?y.tableCellEditing:""}`}),b&&i?f(Ct,{cellEditor:c}):ne(Ae,{children:[f("div",{dangerouslySetInnerHTML:{__html:le===""?ct(y):ut(le,c)}}),f("div",{className:y.tableCellResizer,"data-table-resize":"true"})]}),b&&!i&&f("div",{className:y.tableCellActionButtonContainer,ref:v,children:f("button",{className:y.tableCellActionButton,onClick:re=>{e(!k),re.stopPropagation()},children:f("i",{className:"chevron-down"})})}),k&&h!==null&&Ge.exports.createPortal(f(xt,{cell:n,menuElem:h,updateCellsByID:A,onClose:()=>e(!1),updateTableNode:I,cellCoordMap:l,rows:P,setSortingOptions:w,sortingOptions:M}),document.body),U&&f("div",{className:y.tableCellSortedIndicator})]})}function St({nodeKey:n,rows:l,theme:c}){const[i,E,b]=Le(n),y=x.exports.useRef({point:0,size:0}),[A,I]=x.exports.useState(null),P=x.exports.useRef(null),w=x.exports.useRef(null),M=x.exports.useRef(null),{cellEditorConfig:k}=x.exports.useContext(Te),[e,v]=x.exports.useState(!1),[W,le]=x.exports.useState(!1),[fe,se]=x.exports.useState(!1),[h]=Pe(),X=x.exports.useRef(!1),[U,re]=x.exports.useState(null),Z=x.exports.useRef(null),D=x.exports.useMemo(()=>{const o=new Map;for(let C=0;C<l.length;C++){const _=l[C].cells;for(let p=0;p<_.length;p++){const S=_[p];o.set(S.id,[p,C])}}return o},[l]),R=x.exports.useMemo(()=>{if(A===null)return l;const o=l.slice(1);return o.sort((C,O)=>{const _=C.cells,p=O.cells,S=A.x,K=ge.get(_[S].json)||"",T=ge.get(p[S].json)||"";return K===""||T===""?1:A.type==="ascending"?K.localeCompare(T):T.localeCompare(K)}),o.unshift(l[0]),o},[l,A]),[u,Q]=x.exports.useState(null),N=x.exports.useMemo(()=>{if(k===null)return null;const o=$e({namespace:k.namespace,nodes:k.nodes,onError:C=>k.onError(C,o),theme:k.theme});return o},[k]),[F,J]=x.exports.useState([]),ye=x.exports.useMemo(()=>new Set(F),[F]);x.exports.useEffect(()=>{const o=Z.current;i&&document.activeElement===document.body&&o!==null&&o.focus()},[i]);const L=x.exports.useCallback(o=>{h.update(()=>{const C=be(n);ve(C)&&o(C)})},[h,n]),Oe=()=>{L(o=>{$("history-push"),o.addColumns(1)})},_e=()=>{L(o=>{$("history-push"),o.addRows(1)})},V=x.exports.useCallback((o,C,O)=>{const _=R[C].cells[o].id;if(w.current=_,O){const p=Me(R,u,_,D);J(p)}else Q(_),J(G),me(Z.current,_)},[D,u,R]),ee=x.exports.useCallback(()=>{if(N!==null&&u!==null){const o=JSON.stringify(N.getEditorState());L(C=>{const O=D.get(u);if(O===void 0)return;$("history-push");const[_,p]=O;C.updateCellJSON(_,p,o)})}},[D,N,u,L]),oe=x.exports.useCallback(()=>{setTimeout(()=>{var C;const o=h.getRootElement();o!==null&&(o.focus({preventScroll:!0}),(C=window.getSelection())==null||C.removeAllRanges())},20)},[h]);x.exports.useEffect(()=>{const o=Z.current;if(o===null)return;const C=Re(h),O=T=>{const t=T.clientX-p.x,s=T.clientY-p.y;return t<5||s<5},_=T=>{const t=he(T.target);if(t!==null&&h.isEditable()&&o.contains(T.target)){if(O(T)){E(!0),Q(null),oe();return}if(E(!1),it(T.target)){re(t),o.style.userSelect="none",y.current={point:T.clientX,size:mt(T.target)};return}X.current=!0,u!==t?(e&&ee(),Q(t),v(!1),w.current=t):w.current=null,J(G)}else u!==null&&!ht(T.target)&&(E(!1),X.current=!1,e&&ee(),Q(null),J(G),v(!1),w.current=null)},p=o.getBoundingClientRect(),S=T=>{if(U!==null){const s=M.current;if(s!==null){const{size:r,point:d}=y.current,m=T.clientX-d,g=r+m;let a=T.clientX-p.x;a<10?a=10:a>p.width-10?a=p.width-10:g<20&&(a=d-r+20-p.x),s.style.left=`${a}px`}return}if(!e){const{clientX:s,clientY:r}=T,{width:d,x:m,y:g,height:a}=p,H=s>m+d*.9&&s<m+d+40&&!X.current;le(H);const B=T.target===P.current||r>g+a*.85&&r<g+a+5&&!X.current;se(B)}if(e||!X.current||u===null)return;const t=he(T.target);if(t!==null&&t!==w.current){F.length===0&&(o.style.userSelect="none");const s=Me(R,u,t,D);s.length===1?J(G):J(s),w.current=t}},K=T=>{var t;if(U!==null){const{size:s,point:r}=y.current,d=T.clientX-r;let m=s+d;m<10&&(m=10),L(g=>{const[a]=D.get(U);$("history-push"),g.updateColumnWidth(a,m)}),re(null)}o!==null&&F.length>1&&X.current&&(o.style.userSelect="text",(t=window.getSelection())==null||t.removeAllRanges()),X.current=!1};return C.addEventListener("pointerdown",_),C.addEventListener("pointermove",S),C.addEventListener("pointerup",K),()=>{C.removeEventListener("pointerdown",_),C.removeEventListener("pointermove",S),C.removeEventListener("pointerup",K)}},[N,h,e,R,ee,u,ye,F,D,U,L,E,oe]),x.exports.useEffect(()=>{if(!e&&u!==null){const o=Re(h),C=p=>{if(p!==null&&N!==null){const S=p.json,K=N.parseEditorState(S);N.setEditorState(K)}},O=p=>{const S=he(p.target);if(S===u&&h.isEditable()){const K=de(R,S,D);C(K),v(!0),J(G)}},_=p=>{const S=p.keyCode;if(S===16||S===27||S===9||S===37||S===38||S===39||S===40||S===8||S===46||!h.isEditable())return;if(S===13&&p.preventDefault(),!e&&u!==null&&h.getEditorState().read(()=>Y()===null)&&p.target.contentEditable!=="true"){if(dt(S,p.shiftKey,p.metaKey,p.ctrlKey)){h.dispatchCommand(Ee,p);return}if(ft(S,p.shiftKey,p.metaKey,p.ctrlKey)){h.dispatchCommand(Se,p);return}if(pt(S,p.shiftKey,p.metaKey,p.ctrlKey)){h.dispatchCommand(we,p);return}}if(p.metaKey||p.ctrlKey||p.altKey)return;const K=de(R,u,D);C(K),v(!0),J(G)};return o.addEventListener("dblclick",O),o.addEventListener("keydown",_),()=>{o.removeEventListener("dblclick",O),o.removeEventListener("keydown",_)}}},[N,h,e,R,u,D]);const pe=x.exports.useCallback((o,C)=>{te(R,o,D,N,L,C)},[D,N,R,L]),ae=x.exports.useCallback(()=>u!==null&&!e?(pe([u,...F],()=>{const o=j();o.clear(),o.append(ue())}),!0):(i&&L(o=>{$("history-push"),o.selectNext(),o.remove()}),!1),[e,i,u,F,pe,L]);if(x.exports.useEffect(()=>{const o=Z.current;if(o===null)return;const C=(t,s,r,d)=>{const m=t instanceof KeyboardEvent?null:t.clipboardData;if(t.preventDefault(),m!=null)m.setData("text/html",s),m.setData("text/plain",d),m.setData("application/x-lexical-editor",r);else{const g=navigator.clipboard;if(g!=null){const a=[new ClipboardItem({"text/html":new Blob([s],{type:"text/html"})})];g.write(a)}}},O=async(t,s)=>{try{return t instanceof DataTransfer?t.getData(s):t instanceof ClipboardItem?await(await t.getType(s)).text():""}catch{return""}},_=async t=>{let s=(t instanceof InputEvent?null:t.clipboardData)||null;if(u!==null&&N!==null){if(t.preventDefault(),s===null)try{s=(await navigator.clipboard.read())[0]}catch{}const r=s!==null?await O(s,"application/x-lexical-editor"):"";if(r)try{const g=JSON.parse(r);if(g.namespace===h._config.namespace&&Array.isArray(g.nodes)){te(R,[u],D,N,L,()=>{const a=j();a.clear(),a.append(ue()),a.selectEnd();const H=Ze(g.nodes),B=Y();q(B)&&De(N,H,B)});return}}catch{}const d=s!==null?await O(s,"text/html"):"";if(d)try{const a=new DOMParser().parseFromString(d,"text/html"),H=a.querySelector("table");if(H!=null){const B=et(H);L(ce=>{const[ie,ke]=D.get(u);$("history-push"),ce.mergeRows(ie,ke,B)});return}te(R,[u],D,N,L,()=>{const B=j();B.clear(),B.append(ue()),B.selectEnd();const ce=tt(h,a),ie=Y();q(ie)&&De(N,ce,ie)});return}catch{}const m=s!==null?await O(s,"text/plain"):"";m!=null&&te(R,[u],D,N,L,()=>{const g=j();g.clear(),g.selectEnd();const a=Y();a!==null&&a.insertRawText(m)})}},p=t=>{if(u!==null&&N!==null){const r=de(R,u,D).json,d=Ce.get(r)||null;if(d===null)return;const m=N.parseEditorState(r),g=m.read(()=>j().getTextContent()),a=m.read(()=>JSON.stringify(nt(N,null)));C(t,d,a,g)}},S=t=>{const s=w.current;if(u!==null&&N!==null&&s!==null){const r=Ie(u,s,D);if(r===null)return;const d=lt(R,r),m=d.outerHTML,g=d.outerText,a=h.getEditorState().read(()=>be(n).exportJSON());a.rows=gt(R,r);const H={namespace:N._config.namespace,nodes:[a]},B=JSON.stringify(H);C(t,m,B,g)}},K=(t,s)=>{const r=Y();return u!==null&&!e&&r===null&&s===h?(_(t),X.current=!1,J(G),!0):!1},T=(t,s)=>{const r=Y();return u!==null&&!e&&r===null&&s===h?(F.length===0?p(t):S(t),!0):!1};return Ke(h.registerCommand(qe,t=>{const s=Y();return!!Ne(s)},z),h.registerCommand(we,K,z),h.registerCommand(Ee,T,z),h.registerCommand(Se,(t,s)=>T(t,s)?(ae(),!0):!1,z),h.registerCommand(Ue,ae,z),h.registerCommand(We,ae,z),h.registerCommand(je,t=>u!==null&&!e?(te(R,[u,...F],D,N,L,()=>{at().formatText(t)}),!0):!1,z),h.registerCommand(He,(t,s)=>{const r=Y();if(u===null&&!e&&Ne(r)&&r.has(n)&&r.getNodes().length===1&&s===h){const d=R[0].cells[0].id;return Q(d),me(o,d),t.preventDefault(),t.stopPropagation(),b(),!0}return!1},z),h.registerCommand(Je,t=>{const s=Y();if(!e&&s===null&&u!==null){const r=t.shiftKey,[d,m]=D.get(u);t.preventDefault();let g=null,a=null;if(d===0&&r?m!==0&&(a=m-1,g=R[a].cells.length-1):d===R[m].cells.length-1&&!r?m!==R.length-1&&(a=m+1,g=0):r?(g=d-1,a=m):(g=d+1,a=m),g!==null&&a!==null)return V(g,a,!1),!0}return!1},z),h.registerCommand(Fe,(t,s)=>{const r=Y();if(!e&&r===null){const d=t.shiftKey,m=d&&w.current||u;if(m!==null){const[g,a]=D.get(m);if(a!==0)return V(g,a-1,d),!0}}return!q(r)||s!==N?!1:r.isCollapsed()&&r.anchor.getNode().getTopLevelElementOrThrow().getPreviousSibling()===null?(t.preventDefault(),!0):!1},z),h.registerCommand(Be,(t,s)=>{const r=Y();if(!e&&r===null){const d=t.shiftKey,m=d&&w.current||u;if(m!==null){const[g,a]=D.get(m);if(a!==R.length-1)return V(g,a+1,d),!0}}return!q(r)||s!==N?!1:r.isCollapsed()&&r.anchor.getNode().getTopLevelElementOrThrow().getNextSibling()===null?(t.preventDefault(),!0):!1},z),h.registerCommand(Xe,(t,s)=>{const r=Y();if(!e&&r===null){const d=t.shiftKey,m=d&&w.current||u;if(m!==null){const[g,a]=D.get(m);if(g!==0)return V(g-1,a,d),!0}}return!q(r)||s!==N?!1:r.isCollapsed()&&r.anchor.offset===0?(t.preventDefault(),!0):!1},z),h.registerCommand(ze,(t,s)=>{const r=Y();if(!e&&r===null){const d=t.shiftKey,m=d&&w.current||u;if(m!==null){const[g,a]=D.get(m);if(g!==R[a].cells.length-1)return V(g+1,a,d),!0}}if(!q(r)||s!==N)return!1;if(r.isCollapsed()){const d=r.anchor;if(d.type==="text"&&d.offset===d.getNode().getTextContentSize()||d.type==="element"&&d.offset===d.getNode().getChildrenSize())return t.preventDefault(),!0}return!1},z),h.registerCommand(Ye,(t,s)=>{const r=Y();return!e&&r===null&&s===h?(E(!0),Q(null),oe(),!0):q(r)&&e?(ee(),v(!1),u!==null&&setTimeout(()=>{me(o,u)},20),!0):!1},z))},[D,N,ae,b,h,e,V,n,u,R,ee,oe,F,E,L]),N!==null)return ne("div",{style:{position:"relative"},children:[f("table",{className:`${c.table} ${i?c.tableSelected:""}`,ref:Z,tabIndex:-1,children:f("tbody",{children:R.map(o=>f("tr",{className:c.tableRow,children:o.cells.map(C=>{const{id:O}=C;return f(yt,{cell:C,theme:c,isSelected:ye.has(O),isPrimarySelected:u===O,isEditing:e,sortingOptions:A,cellEditor:N,updateCellsByID:pe,updateTableNode:L,cellCoordMap:D,rows:R,setSortingOptions:I},O)})},o.id))})}),W&&f("button",{className:c.tableAddColumns,onClick:Oe}),fe&&f("button",{className:c.tableAddRows,onClick:_e,ref:P}),U!==null&&f("div",{className:c.tableResizeRuler,ref:M})]})}export{St as default};
