import{r as c,m as q,j as B,a as f,C as oe,o as ie,c as K,p as ae,q as J,D as le,s as Q,t as ce,v as Z,w as ue,u as ee,g as fe,x as de,d as j,$ as z,y as G,z as W,K as ge,k as v,A as me,i as pe,l as he,G as Se,n as Ee,S as Ce,H as xe,I as Ne,F as ye,J as be,N as Te,L as Le,O as Re,P as $e,Q as _e,R as Ie,T as De,U as Pe,V as Ae,W as Me,X as ve,Y as ke}from"./main.0c370d41.js";import{L as we}from"./LexicalNestedComposer.a322e9ed.js";import{I as Oe}from"./ImageResizer.2eca59e4.js";const te=Object.freeze({"	":"\\t","\n":"\\n"}),Y=new RegExp(Object.keys(te).join("|"),"g"),L=Object.freeze({ancestorHasNextSibling:"|",ancestorIsLastChild:" ",hasNextSibling:"\u251C",isLastChild:"\u2514",selectedChar:"^",selectedLine:">"});function je({treeTypeButtonClassName:e,timeTravelButtonClassName:t,timeTravelPanelSliderClassName:n,timeTravelPanelButtonClassName:r,viewClassName:i,timeTravelPanelClassName:a,editor:s}){const[o,S]=c.exports.useState([]),[d,u]=c.exports.useState(""),[h,x]=c.exports.useState(!1),[g,R]=c.exports.useState(!1),E=c.exports.useRef(0),I=c.exports.useRef(null),w=c.exports.useRef(null),[m,D]=c.exports.useState(!1),[P,H]=c.exports.useState(!1),[N,F]=c.exports.useState(!1),k=c.exports.useRef(null),$=Be(s),O=c.exports.useCallback(l=>{const y=U(s,$,g);u(y),h||S(b=>[...b,[Date.now(),l]])},[$,s,h,g]);c.exports.useEffect(()=>{const l=s.getEditorState();!N&&l._nodeMap.size<1e3&&u(U(s,$,g))},[$,s,N,g]),c.exports.useEffect(()=>q(s.registerUpdateListener(({editorState:l})=>{!N&&l._nodeMap.size>1e3&&(k.current=l,H(!0),!N)||O(l)}),s.registerEditableListener(()=>{const l=U(s,$,g);u(l)})),[$,s,g,P,O,N]);const _=o.length;return c.exports.useEffect(()=>{if(m){let l;const y=()=>{const b=E.current;if(b===_-1){D(!1);return}const A=o[b][0],T=o[b+1][0]-A;l=setTimeout(()=>{E.current++;const p=E.current,M=w.current;M!==null&&(M.value=String(p)),s.setEditorState(o[p][1]),y()},T)};return y(),()=>{clearTimeout(l)}}},[o,m,s,_]),c.exports.useEffect(()=>{const l=I.current;if(l!==null)return l.__lexicalEditor=s,()=>{l.__lexicalEditor=null}},[s]),B("div",{className:i,children:[!N&&P?B("div",{style:{padding:20},children:[f("span",{style:{marginRight:20},children:"Detected large EditorState, this can impact debugging performance."}),f("button",{onClick:()=>{F(!0);const l=k.current;l!==null&&(k.current=null,O(l))},style:{background:"transparent",border:"1px solid white",color:"white",cursor:"pointer",padding:5},children:"Show full tree"})]}):null,N?null:f("button",{onClick:()=>R(!g),className:e,type:"button",children:g?"Tree":"Export DOM"}),!h&&(N||!P)&&_>2&&f("button",{onClick:()=>{const l=s.getRootElement();l!==null&&(l.contentEditable="false",E.current=_-1,x(!0))},className:t,type:"button",children:"Time Travel"}),(N||!P)&&f("pre",{ref:I,children:d}),h&&(N||!P)&&B("div",{className:a,children:[f("button",{className:r,onClick:()=>{E.current===_-1&&(E.current=1),D(!m)},type:"button",children:m?"Pause":"Play"}),f("input",{className:n,ref:w,onChange:l=>{const y=Number(l.target.value),b=o[y];b&&(E.current=y,s.setEditorState(b[1]))},type:"range",min:"1",max:_-1}),f("button",{className:r,onClick:()=>{const l=s.getRootElement();if(l!==null){l.contentEditable="true";const y=o.length-1,b=o[y];s.setEditorState(b[1]);const A=w.current;A!==null&&(A.value=String(y)),x(!1),D(!1)}},type:"button",children:"Exit"})]})]})}function Be(e){const[t,n]=c.exports.useState([]);return c.exports.useEffect(()=>{const r=new Set;for(const[i]of e._commands)r.add(e.registerCommand(i,a=>(n(s=>{const o=[...s];return o.push({payload:a,type:i.type?i.type:"UNKNOWN"}),o.length>10&&o.shift(),o}),!1),oe));return()=>r.forEach(i=>i())},[e]),c.exports.useMemo(()=>t,[t])}function He(e){let t="";const n=se(e);t+=`: range ${n!==""?`{ ${n} }`:""} ${e.style!==""?`{ style: ${e.style} } `:""}`;const r=e.anchor,i=e.focus,a=r.offset,s=i.offset;return t+=`
  \u251C anchor { key: ${r.key}, offset: ${a===null?"null":a}, type: ${r.type} }`,t+=`
  \u2514 focus { key: ${i.key}, offset: ${s===null?"null":s}, type: ${i.type} }`,t}function Fe(e){return`: node
  \u2514 [${Array.from(e._nodes).join(", ")}]`}function Ke(e){return`: grid
  \u2514 { grid: ${e.gridKey}, anchorCell: ${e.anchor.key}, focusCell: ${e.focus.key} }`}function U(e,t,n){const r=e.getEditorState(),i=e._config,a=e._compositionKey,s=e._editable;if(n){let d="";return r.read(()=>{d=tt(ie(e))}),d}let o=` root
`;const S=r.read(()=>{const d=K();return ne(ae(),(u,h)=>{const g=`(${u.getKey()})`,R=u.getType()||"",E=u.isSelected(),I=ce(u)?` id: [ ${u.getIDs().join(", ")} ] `:"";o+=`${E?L.selectedLine:" "} ${h.join(" ")} ${g} ${R} ${I} ${ze(u)}
`,o+=et({indent:h,isSelected:E,node:u,nodeKeyDisplay:g,selection:d,typeDisplay:R})}),d===null?": null":J(d)?He(d):le(d)?Ke(d):Fe(d)});if(o+=`
 selection`+S,o+=`

 commands:`,t.length)for(const{type:d,payload:u}of t)o+=`
  \u2514 { type: ${d}, payload: ${u instanceof Event?u.constructor.name:u} }`;else o+=`
  \u2514 None dispatched.`;return o+=`

 editor:`,o+=`
  \u2514 namespace ${i.namespace}`,a!==null&&(o+=`
  \u2514 compositionKey ${a}`),o+=`
  \u2514 editable ${String(s)}`,o}function ne(e,t,n=[]){const r=e.getChildren(),i=r.length;r.forEach((a,s)=>{t(a,n.concat(s===i-1?L.isLastChild:L.hasNextSibling)),Q(a)&&ne(a,t,n.concat(s===i-1?L.ancestorIsLastChild:L.ancestorHasNextSibling))})}function V(e){return Object.entries(te).reduce((t,[n,r])=>t.replace(new RegExp(n,"g"),String(r)),e)}function ze(e){if(Z(e)){const t=e.getTextContent(),n=t.length===0?"(empty)":`"${V(t)}"`,r=Ye(e);return[n,r.length!==0?`{ ${r} }`:null].filter(Boolean).join(" ").trim()}else if(ue(e)){const t=e.getURL(),n=t.length===0?"(empty)":`"${V(t)}"`,r=Ve(e);return[n,r.length!==0?`{ ${r} }`:null].filter(Boolean).join(" ").trim()}else return""}const Ge=[e=>e.hasFormat("bold")&&"Bold",e=>e.hasFormat("code")&&"Code",e=>e.hasFormat("italic")&&"Italic",e=>e.hasFormat("strikethrough")&&"Strikethrough",e=>e.hasFormat("subscript")&&"Subscript",e=>e.hasFormat("superscript")&&"Superscript",e=>e.hasFormat("underline")&&"Underline"],Ue=[e=>e.isDirectionless()&&"Directionless",e=>e.isUnmergeable()&&"Unmergeable"],We=[e=>e.isToken()&&"Token",e=>e.isSegmented()&&"Segmented"];function Ye(e){return[se(e),Xe(e),qe(e)].filter(Boolean).join(", ")}function Ve(e){return[Je(e),Qe(e),Ze(e)].filter(Boolean).join(", ")}function Xe(e){let t=Ue.map(n=>n(e)).filter(Boolean).join(", ").toLocaleLowerCase();return t!==""&&(t="detail: "+t),t}function qe(e){let t=We.map(n=>n(e)).filter(Boolean).join(", ").toLocaleLowerCase();return t!==""&&(t="mode: "+t),t}function se(e){let t=Ge.map(n=>n(e)).filter(Boolean).join(", ").toLocaleLowerCase();return t!==""&&(t="format: "+t),t}function Je(e){let t=e.getTarget();return t!=null&&(t="target: "+t),t}function Qe(e){let t=e.getRel();return t!=null&&(t="rel: "+t),t}function Ze(e){let t=e.getTitle();return t!=null&&(t="title: "+t),t}function et({indent:e,isSelected:t,node:n,nodeKeyDisplay:r,selection:i,typeDisplay:a}){if(!Z(n)||!J(i)||!t||Q(n))return"";const s=i.anchor,o=i.focus;if(n.getTextContent()===""||s.getNode()===i.focus.getNode()&&s.offset===o.offset)return"";const[S,d]=nt(n,i);if(S===d)return"";const u=e[e.length-1]===L.hasNextSibling?L.ancestorHasNextSibling:L.ancestorIsLastChild,h=[...e.slice(0,e.length-1),u],x=Array(S+1).fill(" "),g=Array(d-S).fill(L.selectedChar),R=a.length+3,E=Array(r.length+R).fill(" ");return[L.selectedLine,h.join(" "),[...E,...x,...g].join("")].join(" ")+`
`}function tt(e){const t=document.createElement("div");return t.innerHTML=e.trim(),re(t,0).innerHTML}function re(e,t){const n=new Array(t+++1).join("  "),r=new Array(t-1).join("  ");let i;for(let a=0;a<e.children.length;a++)i=document.createTextNode(`
`+n),e.insertBefore(i,e.children[a]),re(e.children[a],t),e.lastElementChild===e.children[a]&&(i=document.createTextNode(`
`+r),e.appendChild(i));return e}function nt(e,t){const n=t.anchor,r=t.focus,i=e.getTextContent(),a=i.length;let s=-1,o=-1;if(n.type==="text"&&r.type==="text"){const u=n.getNode(),h=r.getNode();u===h&&e===u&&n.offset!==r.offset?[s,o]=n.offset<r.offset?[n.offset,r.offset]:[r.offset,n.offset]:e===u?[s,o]=u.isBefore(h)?[n.offset,a]:[0,n.offset]:e===h?[s,o]=h.isBefore(u)?[r.offset,a]:[0,r.offset]:[s,o]=[0,a]}const S=(i.slice(0,s).match(Y)||[]).length,d=(i.slice(s,o).match(Y)||[]).length;return[s+S,o+S+d]}function st(){const[e]=ee();return f(je,{viewClassName:"tree-view-output",treeTypeButtonClassName:"debug-treetype-button",timeTravelPanelClassName:"debug-timetravel-panel",timeTravelButtonClassName:"debug-timetravel-button",timeTravelPanelSliderClassName:"debug-timetravel-panel-slider",timeTravelPanelButtonClassName:"debug-timetravel-panel-button",editor:e})}const X=new Set;function rt(e){if(!X.has(e))throw new Promise(t=>{const n=new Image;n.src=e,n.onload=()=>{X.add(e),t(null)}})}function ot({altText:e,className:t,imageRef:n,src:r,width:i,height:a,maxWidth:s}){return rt(r),f("img",{className:t||void 0,src:r,alt:e,ref:n,style:{height:a,maxWidth:s,width:i},draggable:"false"})}function ct({src:e,altText:t,nodeKey:n,width:r,height:i,maxWidth:a,resizable:s,showCaption:o,caption:S,captionsEnabled:d}){const u=c.exports.useRef(null),h=c.exports.useRef(null),[x,g,R]=fe(n),[E,I]=c.exports.useState(!1),{isCollabActive:w}=de(),[m]=ee(),[D,P]=c.exports.useState(null),H=c.exports.useRef(null),N=c.exports.useCallback(C=>{if(x&&j(K())){C.preventDefault();const p=z(n);G(p)&&p.remove(),g(!1)}return!1},[x,n,g]),F=c.exports.useCallback(C=>{const T=K(),p=h.current;if(x&&j(T)&&T.getNodes().length===1){if(o)return W(null),C.preventDefault(),S.focus(),!0;if(p!==null&&p!==document.activeElement)return C.preventDefault(),p.focus(),!0}return!1},[S,x,o]),k=c.exports.useCallback(C=>H.current===S||h.current===C.target?(W(null),m.update(()=>{g(!0);const T=m.getRootElement();T!==null&&T.focus()}),!0):!1,[S,m,g]);c.exports.useEffect(()=>{let C=!0;const T=q(m.registerUpdateListener(({editorState:p})=>{C&&P(p.read(()=>K()))}),m.registerCommand(Ce,(p,M)=>(H.current=M,!1),v),m.registerCommand(Ee,p=>{const M=p;return E?!0:M.target===u.current?(M.shiftKey?g(!x):(R(),g(!0)),!0):!1},v),m.registerCommand(Se,p=>p.target===u.current?(p.preventDefault(),!0):!1,v),m.registerCommand(he,N,v),m.registerCommand(pe,N,v),m.registerCommand(me,F,v),m.registerCommand(ge,k,v));return()=>{C=!1,T()}},[R,m,E,x,n,N,F,k,g]);const $=()=>{m.update(()=>{const C=z(n);G(C)&&C.setShowCaption(!0)})},O=(C,T)=>{setTimeout(()=>{I(!1)},200),m.update(()=>{const p=z(n);G(p)&&p.setWidthAndHeight(C,T)})},_=()=>{I(!0)},{historyState:l}=xe(),{settings:{showNestedEditorTreeView:y}}=Ne(),b=x&&j(D)&&!E,A=x||E;return f(c.exports.Suspense,{fallback:null,children:B(ye,{children:[f("div",{draggable:b,children:f(ot,{className:A?`focused ${j(D)?"draggable":""}`:null,src:e,altText:t,imageRef:u,width:r,height:i,maxWidth:a})}),o&&f("div",{className:"image-caption-container",children:B(we,{initialEditor:S,children:[f(be,{}),f(Te,{}),f(Le,{}),f(Re,{}),f($e,{}),f(_e,{}),w?f(Ie,{id:S.getKey(),providerFactory:De,shouldBootstrap:!0}):f(Pe,{externalHistoryState:l}),f(Ae,{contentEditable:f(Me,{className:"ImageNode__contentEditable"}),placeholder:f(ve,{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:ke}),y===!0?f(st,{}):null]})}),s&&j(D)&&A&&f(Oe,{showCaption:o,setShowCaption:$,editor:m,buttonRef:h,imageRef:u,maxWidth:a,onResizeStart:_,onResizeEnd:O,captionsEnabled:d})]})})}export{ct as default};
