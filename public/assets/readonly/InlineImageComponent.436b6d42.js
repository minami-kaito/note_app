import{j as f,a as e,a0 as B,r as s,g as $,u as Y,d as _,c as A,$ as k,a1 as K,z as T,m as j,K as G,k as C,A as U,i as W,l as z,G as H,n as J,S as V,F as O,J as X,L as q,a2 as Q,a3 as Z,V as ee,W as te,X as ae,Y as ne,a4 as le,a5 as se,B as oe}from"./main.0c370d41.js";import{L as re}from"./LexicalNestedComposer.a322e9ed.js";function ie({children:l,label:i,className:a,...h}){return f("div",{className:"Input__wrapper",children:[e("label",{style:{marginTop:"-1em"},className:"Input__label",children:i}),e("select",{...h,className:a||"select",children:l})]})}const P=new Set;function ce(l){if(!P.has(l))throw new Promise(i=>{const a=new Image;a.src=l,a.onload=()=>{P.add(l),i(null)}})}function ue({altText:l,className:i,imageRef:a,src:h,width:c,height:m,position:u}){return ce(h),e("img",{className:i||void 0,src:h,alt:l,ref:a,"data-position":u,style:{display:"block",height:m,width:c},draggable:"false"})}function de({activeEditor:l,nodeKey:i,onClose:a}){const c=l.getEditorState().read(()=>k(i)),[m,u]=s.exports.useState(c.getAltText()),[N,b]=s.exports.useState(c.getShowCaption()),[S,E]=s.exports.useState(c.getPosition()),x=g=>{b(g.target.checked)},r=g=>{E(g.target.value)},d=()=>{const g={altText:m,position:S,showCaption:N};c&&l.update(()=>{c.update(g)}),a()};return f(O,{children:[e("div",{style:{marginBottom:"1em"},children:e(le,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:u,value:m,"data-test-id":"image-modal-alt-text-input"})}),f(ie,{style:{marginBottom:"1em",width:"208px"},value:S,label:"Position",name:"position",id:"position-select",onChange:r,children:[e("option",{value:"left",children:"Left"}),e("option",{value:"right",children:"Right"}),e("option",{value:"full",children:"Full Width"})]}),f("div",{className:"Input__wrapper",children:[e("input",{id:"caption",type:"checkbox",checked:N,onChange:x}),e("label",{htmlFor:"caption",children:"Show Caption"})]}),e(se,{children:e(oe,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>d(),children:"Confirm"})})]})}function pe({src:l,altText:i,nodeKey:a,width:h,height:c,showCaption:m,caption:u,position:N}){const[b,S]=B(),E=s.exports.useRef(null),x=s.exports.useRef(null),[r,d,g]=$(a),[n]=Y(),[M,w]=s.exports.useState(null),D=s.exports.useRef(null),v=s.exports.useCallback(o=>{if(r&&_(A())){o.preventDefault();const t=k(a);K(t)&&(t==null||t.remove()),d(!1)}return!1},[r,a,d]),L=s.exports.useCallback(o=>{const p=A(),t=x.current;if(r&&_(p)&&p.getNodes().length===1){if(m)return T(null),o.preventDefault(),u.focus(),!0;if(t!==null&&t!==document.activeElement)return o.preventDefault(),t.focus(),!0}return!1},[u,r,m]),R=s.exports.useCallback(o=>D.current===u||x.current===o.target?(T(null),n.update(()=>{d(!0);const p=n.getRootElement();p!==null&&p.focus()}),!0):!1,[u,n,d]);s.exports.useEffect(()=>{let o=!0;const p=j(n.registerUpdateListener(({editorState:t})=>{o&&w(t.read(()=>A()))}),n.registerCommand(V,(t,I)=>(D.current=I,!1),C),n.registerCommand(J,t=>{const I=t;return I.target===E.current?(I.shiftKey?d(!r):(g(),d(!0)),!0):!1},C),n.registerCommand(H,t=>t.target===E.current?(t.preventDefault(),!0):!1,C),n.registerCommand(z,v,C),n.registerCommand(W,v,C),n.registerCommand(U,L,C),n.registerCommand(G,R,C));return()=>{o=!1,p()}},[g,n,r,a,v,L,R,d]);const y=r&&_(M),F=r;return f(s.exports.Suspense,{fallback:null,children:[f(O,{children:[f("div",{draggable:y,children:[e("button",{className:"image-edit-button",ref:x,onClick:()=>{S("Update Inline Image",o=>e(de,{activeEditor:n,nodeKey:a,onClose:o}))},children:"Edit"}),e(ue,{className:F?`focused ${_(M)?"draggable":""}`:null,src:l,altText:i,imageRef:E,width:h,height:c,position:N})]}),m&&e("div",{className:"image-caption-container",children:f(re,{initialEditor:u,children:[e(X,{}),e(q,{}),e(Q,{}),e(Z,{}),e(ee,{contentEditable:e(te,{className:"InlineImageNode__contentEditable"}),placeholder:e(ae,{className:"InlineImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:ne})]})})]}),b]})}export{de as UpdateInlineImageDialog,pe as default};
